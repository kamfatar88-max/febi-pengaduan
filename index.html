INDEXHTML <!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Pengaduan</title>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<style>
body{font-family:sans-serif; margin:20px;}
.tab{display:none;}
.tab.active{display:block;}
button.tablink{margin:5px;}
table{border-collapse:collapse; width:100%;}
table, th, td{border:1px solid #ccc;}
th,td{padding:5px;}
</style>
</head>
<body>

<h2>Dashboard Layanan Pengaduan</h2>
<div>
<button class="tablink" onclick="openTab('inputAduan')">Input Aduan</button>
<button class="tablink" onclick="openTab('inputRespon')">Input Respon</button>
<button class="tablink" onclick="openTab('dataAduan')">Data Aduan</button>
<button class="tablink" onclick="openTab('statistik')">Statistik</button>
</div>

<!-- Input Aduan -->
<div id="inputAduan" class="tab">
<h3>Input Aduan</h3>
<form id="formAduan">
Nama: <input type="text" name="nama"><br>
Jabatan: 
<select name="jabatan"><option>Mahasiswa</option><option>Tendik</option><option>Dosen</option></select><br>
Isi Aduan:<br><textarea name="isi"></textarea><br>
<button type="submit">Kirim</button>
</form>
<div id="msgAduan"></div>
</div>

<!-- Input Respon -->
<div id="inputRespon" class="tab">
<h3>Input Respon</h3>
<form id="formRespon">
ID Aduan: <input type="text" name="id"><br>
Identifikasi Masalah: <input type="text" name="identifikasi"><br>
Sumber Masalah: <input type="text" name="sumber"><br>
Rencana Aksi: <input type="text" name="rencana"><br>
Waktu Penyelesaian: <input type="date" name="waktu"><br>
Penanggung Jawab: <input type="text" name="pj"><br>
Status: <select name="status"><option>Belum Diproses</option><option>Dalam Proses</option><option>Selesai</option></select><br>
<button type="submit">Kirim Respon</button>
</form>
<div id="msgRespon"></div>
</div>

<!-- Data Aduan -->
<div id="dataAduan" class="tab">
<h3>Data Aduan</h3>
<div id="dataAduanTable"></div>
</div>

<!-- Statistik -->
<div id="statistik" class="tab">
<h3>Statistik</h3>
<div id="chart_div"></div>
</div>

<script>
const WEBAPP_URL = "PASTE_WEBAPP_URL_HERE"; // ganti dengan URL WebApp

// Tab
function openTab(tabName){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById(tabName).classList.add('active');
}
openTab('inputAduan'); // default

// Submit Aduan
document.getElementById("formAduan").onsubmit = async e=>{
  e.preventDefault();
  const fd = new FormData(e.target);
  fd.append("action","addAduan");
  const data = Object.fromEntries(fd.entries());
  const res = await fetch(WEBAPP_URL,{method:"POST",body:JSON.stringify(data),headers:{"Content-Type":"application/json"}});
  const json = await res.json();
  document.getElementById("msgAduan").innerText = json.message;
  e.target.reset();
  loadData(); loadStatistik();
};

// Submit Respon
document.getElementById("formRespon").onsubmit = async e=>{
  e.preventDefault();
  const fd = new FormData(e.target);
  fd.append("action","addRespon");
  const data = Object.fromEntries(fd.entries());
  const res = await fetch(WEBAPP_URL,{method:"POST",body:JSON.stringify(data),headers:{"Content-Type":"application/json"}});
  const json = await res.json();
  document.getElementById("msgRespon").innerText = json.message;
  e.target.reset();
  loadData(); loadStatistik();
};

// Load Data
async function loadData(){
  const res = await fetch(WEBAPP_URL+"?action=getData");
  let data = await res.json();
  if(!Array.isArray(data)) { console.error("Data bukan array:", data); return; }

  google.charts.load('current', {'packages':['table']});
  google.charts.setOnLoadCallback(()=>{
    const table = new google.visualization.DataTable();
    table.addColumn('string','ID');
    table.addColumn('string','Nama');
    table.addColumn('string','Jabatan');
    table.addColumn('string','Isi Aduan');
    table.addColumn('string','Status');
    table.addColumn('string','Respon');
    table.addRows(data);
    const chart = new google.visualization.Table(document.getElementById('dataAduanTable'));
    chart.draw(table,{showRowNumber:true,width:'100%'});
  });
}
loadData();

// Load Statistik
async function loadStatistik(){
  const res = await fetch(WEBAPP_URL+"?action=getData");
  let data = await res.json();
  if(!Array.isArray(data)) return;

  const total = data.length;
  const selesai = data.filter(d=>d[4]=="Selesai").length;
  const proses = data.filter(d=>d[4]=="Dalam Proses").length;
  const belum = data.filter(d=>d[4]=="Belum Diproses").length;

  google.charts.load('current', {'packages':['corechart']});
  google.charts.setOnLoadCallback(()=>{
    const chartData = google.visualization.arrayToDataTable([
      ['Status','Jumlah'],
      ['Belum Diproses',belum],
      ['Dalam Proses',proses],
      ['Selesai',selesai]
    ]);
    const options = {title:'Statistik Aduan'};
    const chart = new google.visualization.PieChart(document.getElementById('chart_div'));
    chart.draw(chartData,options);
  });
}
</script>

</body>
</html>
