<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard Pengaduan - FEBI UINSI</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f4f7fc;
      color: #333;
    }
    .container {
      max-width: 1200px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: #003366;
      margin-bottom: 10px;
    }
    .subtitle {
      text-align: center;
      color: #007bff;
      font-size: 1.1em;
      margin-bottom: 20px;
    }
    .tabs {
      display: flex;
      gap: 5px;
      margin-bottom: 20px;
    }
    .tab {
      padding: 12px 20px;
      cursor: pointer;
      background: #e9ecef;
      border-radius: 8px 8px 0 0;
      font-weight: 600;
      transition: 0.3s;
    }
    .tab:hover {
      background: #dde2e6;
    }
    .tab.active {
      background: #007bff;
      color: white;
    }
    .tab-content {
      display: none;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 0 0 8px 8px;
      background: #fdfdfd;
    }
    .tab-content.active {
      display: block;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      background: #0056b3;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th {
      background: #f1f1f1;
    }
    tr:hover {
      background: #f9f9f9;
    }
    .no-data {
      text-align: center;
      padding: 30px;
      color: #888;
      font-style: italic;
    }
    .form-respon {
      margin-top: 20px;
      padding: 20px;
      border: 1px dashed #007bff;
      border-radius: 8px;
      background: #f8f9ff;
    }
    .export-btn {
      background: #28a745;
    }
    .export-btn:hover {
      background: #218838;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>Layanan Pengaduan FEBI UINSI</h1>
    <p class="subtitle">Fakultas Ekonomi dan Bisnis Islam - Universitas Islam Negeri Samarinda</p>

    <!-- Tabs -->
    <div class="tabs">
      <div class="tab active" onclick="openTab('input')">Input Pengaduan</div>
      <div class="tab" onclick="openTab('respon')">Respon Pengaduan</div>
      <div class="tab" onclick="openTab('data')">Data Pengaduan</div>
      <div class="tab" onclick="openTab('statistik')">Statistik</div>
    </div>

    <!-- Tab: Input Pengaduan -->
    <div id="input" class="tab-content active">
      <h2>Formulir Pengaduan</h2>
      <input type="text" id="nama" placeholder="Nama Lengkap" required />
      <select id="jabatan" required>
        <option value="">Pilih Jabatan</option>
        <option value="Mahasiswa">Mahasiswa</option>
        <option value="Dosen">Dosen</option>
        <option value="Tendik">Tendik</option>
      </select>
      <textarea id="isiAduan" placeholder="Jelaskan pengaduan Anda..." rows="5" required></textarea>
      <button onclick="submitPengaduan()">Kirim Pengaduan</button>
    </div>

    <!-- Tab: Respon Pengaduan -->
    <div id="respon" class="tab-content">
      <h2>Daftar Pengaduan untuk Ditanggapi</h2>
      <p>Klik "Tanggapi" untuk mengisi respons terhadap pengaduan.</p>
      <table id="tabelRespon">
        <thead>
          <tr>
            <th>Nama</th>
            <th>Jabatan</th>
            <th>Aduan (Ringkasan)</th>
            <th>Status</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Tab: Data Pengaduan -->
    <div id="data" class="tab-content">
      <h2>Matrik Data Pengaduan</h2>
      <button class="export-btn" onclick="exportToCSV()">ðŸ“¤ Export ke CSV</button>
      <table id="tabelData">
        <thead>
          <tr>
            <th>Nama</th>
            <th>Jabatan</th>
            <th>Aduan</th>
            <th>Identifikasi</th>
            <th>Sumber</th>
            <th>Rencana Aksi</th>
            <th>Waktu</th>
            <th>Penanggung Jawab</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Tab: Statistik -->
    <div id="statistik" class="tab-content">
      <h2>Statistik Pengaduan</h2>
      <div style="background:#e3f2fd; padding:15px; border-radius:8px;">
        <p><strong>Total Pengaduan:</strong> <span id="total">0</span></p>
        <p><strong>Sudah Ditanggapi:</strong> <span id="sudah">0</span></p>
        <p><strong>Belum Ditanggapi:</strong> <span id="belum">0</span></p>
        <p><strong>Menurut Jabatan:</strong></p>
        <ul id="statJabatan"><li>Belum ada data</li></ul>
      </div>
    </div>
  </div>

  <!-- Script -->
  <script>
    // Ambil data dari localStorage
    let pengaduanList = JSON.parse(localStorage.getItem("pengaduanList")) || [];
    let responList = JSON.parse(localStorage.getItem("responList")) || {};

    // Buka tab
    function openTab(tabName) {
      document.querySelectorAll(".tab-content").forEach(t => t.classList.remove("active"));
      document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
      document.getElementById(tabName).classList.add("active");
      document.querySelector(`.tab[onclick="openTab('${tabName}')"]`).classList.add("active");

      if (tabName === "respon") renderRespon();
      if (tabName === "data") renderData();
      if (tabName === "statistik") renderStatistik();
    }

    // Kirim pengaduan
    function submitPengaduan() {
      const nama = document.getElementById("nama").value.trim();
      const jabatan = document.getElementById("jabatan").value;
      const isiAduan = document.getElementById("isiAduan").value.trim();

      if (!nama || !jabatan || !isiAduan) {
        alert("Semua field wajib diisi!");
        return;
      }

      const newPengaduan = {
        id: Date.now().toString(),
        nama,
        jabatan,
        isiAduan
      };

      pengaduanList.push(newPengaduan);
      localStorage.setItem("pengaduanList", JSON.stringify(pengaduanList));

      alert("Pengaduan berhasil dikirim!");
      document.getElementById("nama").value = "";
      document.getElementById("jabatan").value = "";
      document.getElementById("isiAduan").value = "";

      renderRespon();
      renderData();
      renderStatistik();
    }

    // Render daftar pengaduan untuk respons
    function renderRespon() {
      const tbody = document.querySelector("#tabelRespon tbody");
      tbody.innerHTML = "";

      if (pengaduanList.length === 0) {
        tbody.innerHTML = `<tr><td colspan="5" class="no-data">Belum ada pengaduan dari pengguna.</td></tr>`;
        return;
      }

      pengaduanList.forEach(item => {
        const status = responList[item.id] ? "Selesai" : "Belum";
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${item.nama}</td>
          <td>${item.jabatan}</td>
          <td title="${item.isiAduan}">${item.isiAduan.substring(0, 60)}${item.isiAduan.length > 60 ? "..." : ""}</td>
          <td><span style="color: ${status === 'Selesai' ? 'green' : 'red'}; font-weight: bold;">${status}</span></td>
          <td><button onclick="showResponseForm('${item.id}', '${item.nama.replace(/'/g, "\\'")}', '${item.isiAduan.replace(/'/g, "\\'")}')">Tanggapi</button></td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Tampilkan form respons terpisah
    function showResponseForm(id, nama, aduan) {
      const container = document.querySelector("#respon");
      container.innerHTML += ''; // Clear form lama

      const formHtml = `
        <div class="form-respon" id="form-respon">
          <h3>Respon untuk: ${nama}</h3>
          <p><strong>Aduan:</strong> ${aduan}</p>
          <input type="hidden" id="respon-id" value="${id}" />
          <input type="text" id="identifikasi" placeholder="Identifikasi Masalah" />
          <input type="text" id="sumber" placeholder="Sumber Masalah" />
          <textarea id="rencana" placeholder="Rencana Aksi" rows="3"></textarea>
          <input type="date" id="waktu" placeholder="Waktu Penyelesaian" />
          <input type="text" id="penanggungJawab" placeholder="Penanggung Jawab" />
          <button onclick="saveResponse()">Simpan Respon</button>
          <button type="button" style="background:#6c757d; margin-top:10px;" onclick="closeResponseForm()">Batal</button>
        </div>
      `;
      container.insertAdjacentHTML("beforeend", formHtml);
    }

    // Simpan respons
    function saveResponse() {
      const id = document.getElementById("respon-id").value;
      const identifikasi = document.getElementById("identifikasi").value.trim();
      const sumber = document.getElementById("sumber").value.trim();
      const rencana = document.getElementById("rencana").value.trim();
      const waktu = document.getElementById("waktu").value;
      const penanggungJawab = document.getElementById("penanggungJawab").value.trim();

      if (!identifikasi || !rencana || !waktu || !penanggungJawab) {
        alert("Semua field respons wajib diisi!");
        return;
      }

      responList[id] = { identifikasi, sumber, rencana, waktu, penanggungJawab };
      localStorage.setItem("responList", JSON.stringify(responList));

      alert("Respons berhasil disimpan!");
      closeResponseForm();
      renderRespon();
      renderData();
      renderStatistik();
    }

    // Tutup form respons
    function closeResponseForm() {
      const form = document.getElementById("form-respon");
      if (form) form.remove();
    }

    // Render data gabungan
    function renderData() {
      const tbody = document.querySelector("#tabelData tbody");
      tbody.innerHTML = "";

      if (pengaduanList.length === 0) {
        tbody.innerHTML = `<tr><td colspan="9" class="no-data">Belum ada pengaduan.</td></tr>`;
        return;
      }

      pengaduanList.forEach(item => {
        const r = responList[item.id] || {};
        const status = r.identifikasi ? "Selesai" : "Belum";
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${item.nama}</td>
          <td>${item.jabatan}</td>
          <td>${item.isiAduan.substring(0, 40)}...</td>
          <td>${r.identifikasi || "-"}</td>
          <td>${r.sumber || "-"}</td>
          <td>${r.rencana || "-"}</td>
          <td>${r.waktu || "-"}</td>
          <td>${r.penanggungJawab || "-"}</td>
          <td style="color:${status==='Selesai'?'green':'red'}; font-weight:bold;">${status}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Render statistik
    function renderStatistik() {
      const total = pengaduanList.length;
      const sudah = Object.keys(responList).length;
      const belum = total - sudah;

      document.getElementById("total").textContent = total;
      document.getElementById("sudah").textContent = sudah;
      document.getElementById("belum").textContent = belum;

      const ul = document.getElementById("statJabatan");
      ul.innerHTML = "";

      if (total === 0) {
        ul.innerHTML = "<li>Belum ada pengaduan</li>";
        return;
      }

      const jabatanCount = {};
      pengaduanList.forEach(p => jabatanCount[p.jabatan] = (jabatanCount[p.jabatan] || 0) + 1);
      for (const [jab, count] of Object.entries(jabatanCount)) {
        const li = document.createElement("li");
        li.textContent = `${jab}: ${count} pengaduan`;
        ul.appendChild(li);
      }
    }

    // Export ke CSV
    function exportToCSV() {
      if (pengaduanList.length === 0) {
        alert("Tidak ada data untuk diekspor.");
        return;
      }

      let csv = [
        ["Nama", "Jabatan", "Aduan", "Identifikasi", "Sumber", "Rencana Aksi", "Waktu", "Penanggung Jawab", "Status"].join(",")
      ];

      pengaduanList.forEach(item => {
        const r = responList[item.id] || {};
        const status = r.identifikasi ? "Selesai" : "Belum";
        const row = [
          `"${item.nama}"`,
          `"${item.jabatan}"`,
          `"${item.isiAduan.replace(/"/g, '""')}"`,
          `"${r.identifikasi || "-"}"`,
          `"${r.sumber || "-"}"`,
          `"${r.rencana || "-"}"`,
          `"${r.waktu || "-"}"`,
          `"${r.penanggungJawab || "-"}"`,
          `"${status}"`
        ];
        csv.push(row.join(","));
      });

      const blob = new Blob([csv.join("\n")], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `pengaduan_febi_uinsi_${new Date().toISOString().slice(0,10)}.csv`;
      a.click();
    }

    // Inisialisasi
    document.addEventListener("DOMContentLoaded", function () {
      renderRespon();
      renderData();
      renderStatistik();
    });
  </script>
</body>
</html>
