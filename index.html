<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Layanan Pengaduan</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f4f6f9;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .tabs {
      display: flex;
      gap: 5px;
      margin-bottom: 20px;
    }
    .tab {
      padding: 12px 20px;
      cursor: pointer;
      background: #e0e0e0;
      border-radius: 6px 6px 0 0;
      font-weight: 600;
    }
    .tab.active {
      background: #007bff;
      color: white;
    }
    .tab-content {
      display: none;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 0 0 6px 6px;
    }
    .tab-content.active {
      display: block;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 16px;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      padding: 12px;
      border: 1px solid #ccc;
      text-align: left;
    }
    th {
      background: #f8f9fa;
    }
    .no-data {
      text-align: center;
      padding: 30px;
      color: #888;
      font-style: italic;
    }
    .export-btn {
      background: #28a745;
    }
    .export-btn:hover {
      background: #218838;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>Layanan Pengaduan</h1>

    <!-- Tabs -->
    <div class="tabs">
      <div class="tab active" onclick="openTab('input')">Input Pengaduan</div>
      <div class="tab" onclick="openTab('respon')">Respon Pengaduan</div>
      <div class="tab" onclick="openTab('data')">Data Pengaduan</div>
      <div class="tab" onclick="openTab('statistik')">Statistik</div>
    </div>

    <!-- Tab Input -->
    <div id="input" class="tab-content active">
      <h2>Kirim Pengaduan</h2>
      <input type="text" id="nama" placeholder="Nama Lengkap" />
      <select id="jabatan">
        <option value="">Pilih Jabatan</option>
        <option value="Mahasiswa">Mahasiswa</option>
        <option value="Dosen">Dosen</option>
        <option value="Tendik">Tendik</option>
      </select>
      <textarea id="isiAduan" placeholder="Isi pengaduan..." rows="5"></textarea>
      <button onclick="submitPengaduan()">Kirim Pengaduan</button>
    </div>

    <!-- Tab Respon -->
    <div id="respon" class="tab-content">
      <h2>Daftar Pengaduan</h2>
      <table>
        <thead>
          <tr>
            <th>Nama</th>
            <th>Jabatan</th>
            <th>Aduan</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="tabelRespon"></tbody>
      </table>
    </div>

    <!-- Tab Data -->
    <div id="data" class="tab-content">
      <h2>Data Pengaduan</h2>
      <button class="export-btn" onclick="exportCSV()">Export ke CSV</button>
      <table>
        <thead>
          <tr>
            <th>Nama</th>
            <th>Jabatan</th>
            <th>Aduan</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="tabelData"></tbody>
      </table>
    </div>

    <!-- Tab Statistik -->
    <div id="statistik" class="tab-content">
      <h2>Statistik</h2>
      <p>Total Pengaduan: <strong><span id="total">0</span></strong></p>
      <p>Sudah Ditanggapi: <strong><span id="sudah">0</span></strong></p>
      <p>Belum Ditanggapi: <strong><span id="belum">0</span></strong></p>
    </div>
  </div>

  <script>
    let pengaduanList = JSON.parse(localStorage.getItem("pengaduanList")) || [];
    let responList = JSON.parse(localStorage.getItem("responList")) || {};

    function openTab(tabName) {
      document.querySelectorAll(".tab-content").forEach(t => t.classList.remove("active"));
      document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
      document.getElementById(tabName).classList.add("active");
      document.querySelector(`.tab[onclick="openTab('${tabName}')"]`).classList.add("active");

      if (tabName === "respon") renderRespon();
      if (tabName === "data") renderData();
      if (tabName === "statistik") renderStatistik();
    }

    function submitPengaduan() {
      const nama = document.getElementById("nama").value.trim();
      const jabatan = document.getElementById("jabatan").value;
      const isiAduan = document.getElementById("isiAduan").value.trim();

      if (!nama || !jabatan || !isiAduan) {
        alert("Semua field wajib diisi!");
        return;
      }

      pengaduanList.push({
        id: Date.now().toString(),
        nama,
        jabatan,
        isiAduan
      });

      localStorage.setItem("pengaduanList", JSON.stringify(pengaduanList));
      alert("Pengaduan berhasil dikirim!");

      document.getElementById("nama").value = "";
      document.getElementById("jabatan").value = "";
      document.getElementById("isiAduan").value = "";

      renderRespon();
      renderData();
      renderStatistik();
    }

    function renderRespon() {
      const tbody = document.getElementById("tabelRespon");
      tbody.innerHTML = "";
      pengaduanList.forEach(p => {
        const status = responList[p.id] ? "Selesai" : "Belum";
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${p.nama}</td>
          <td>${p.jabatan}</td>
          <td>${p.isiAduan.substring(0, 60)}...</td>
          <td><strong style="color:${status==='Selesai'?'green':'red'}">${status}</strong></td>
        `;
        tbody.appendChild(tr);
      });
      if (pengaduanList.length === 0) {
        tbody.innerHTML = `<tr><td colspan="4" class="no-data">Belum ada pengaduan.</td></tr>`;
      }
    }

    function renderData() {
      const tbody = document.getElementById("tabelData");
      tbody.innerHTML = "";
      pengaduanList.forEach(p => {
        const status = responList[p.id] ? "Selesai" : "Belum";
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${p.nama}</td>
          <td>${p.jabatan}</td>
          <td>${p.isiAduan.substring(0, 60)}...</td>
          <td>${status}</td>
        `;
        tbody.appendChild(tr);
      });
      if (pengaduanList.length === 0) {
        tbody.innerHTML = `<tr><td colspan="4" class="no-data">Belum ada data.</td></tr>`;
      }
    }

    function renderStatistik() {
      const total = pengaduanList.length;
      const sudah = Object.keys(responList).length;
      const belum = total - sudah;
      document.getElementById("total").textContent = total;
      document.getElementById("sudah").textContent = sudah;
      document.getElementById("belum").textContent = belum;
    }

    function exportCSV() {
      if (pengaduanList.length === 0) {
        alert("Tidak ada data untuk diekspor.");
        return;
      }
      let csv = "Nama,Jabatan,Aduan,Status\n";
      pengaduanList.forEach(p => {
        const status = responList[p.id] ? "Selesai" : "Belum";
        csv += `"${p.nama}","${p.jabatan}","${p.isiAduan.replace(/"/g, '""')}","${status}"\n`;
      });
      const blob = new Blob([csv], { type: "text/csv" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "pengaduan.csv";
      a.click();
    }

    // Inisialisasi
    document.addEventListener("DOMContentLoaded", () => {
      renderRespon();
      renderData();
      renderStatistik();
    });
  </script>
</body>
</html>